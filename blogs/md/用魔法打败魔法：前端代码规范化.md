## ç›®å½•
1. å·¥å…·ç®€ä»‹
2. å®ç°æ€è·¯
3. å…·ä½“å®ç°
4. æ€»ç»“
5. é™„å½•

> ä»£ç åƒä¸‡è¡Œï¼Œè§„èŒƒç¬¬ä¸€è¡Œã€‚<br>ç¼–ç ä¸è§„èŒƒï¼ŒåŒäº‹ä¸¤è¡Œæ³ªã€‚

æ—©å‡ å¹´æ¥æ‰‹è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€å †bugä¸è¯´ï¼Œä»£ç è¿˜åˆè‡­åˆé•¿ï¼Œæ®è¯´ä¹‹å‰å†™ä»£ç çš„é‚£ä½ä»å…„ç»å¸¸æ”¹ä¸€ä¸ªbugåˆå¸¦å‡ºåä¸ªbugğŸŒé¡¹ç›®é‡Œå……æ–¥ç€å„ç§å«ä¹‰ä¸æ˜çš„å˜é‡ã€æ²¡æœ‰ç”¨åˆ°çš„ä¸çŸ¥é“ä»å“ªé‡Œå¤åˆ¶ç²˜è´´è¿‡æ¥çš„å‡½æ•°ã€ä¹±ä¸ƒå…«ç³Ÿçš„consoleã€éšå¿ƒæ‰€æ¬²çš„ç©ºè¡Œå’Œæ¯«æ— æ„ä¹‰çš„æ³¨é‡Šâ€¦â€¦

![](https://img-blog.csdnimg.cn/img_convert/aefcee2c2846038e4601219ce28b3b90.png)

å¾ˆå¤šç¨‹åºå‘˜æ²¡æœ‰ä»£ç è§„èŒƒæ„è¯†ï¼Œç»å¸¸è§‰å¾—åªè¦åŠŸèƒ½èƒ½ç”¨å°±è¡Œäº†ï¼Œä»£ç è§„èŒƒæµªè´¹æ—¶é—´ï¼Œäºæ˜¯å†™å‡ºæ¥çš„ä»£ç è¿‡ä¸€æ®µæ—¶é—´å¯èƒ½è¿è‡ªå·±éƒ½çœ‹ä¸æ‡‚æ˜¯å¨ä»€ä¹ˆä¸œè¥¿ï¼Œæ›´ä¸ç”¨è¯´æ¥æ‰‹çš„åŒäº‹äº†ã€‚

ä»Šæ—¥ä¾¿æ¥è¯´è¯´ï¼Œå¦‚ä½•**ä»æŠ€æœ¯å±‚é¢ï¼Œå®ç°ä»£ç è§„èŒƒä»¥åŠä»£ç æäº¤è§„èŒƒ**ã€‚

### 1ã€å·¥å…·ç®€ä»‹
1. *husky*ï¼šä¸€ä¸ªGit hookså·¥å…·ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨gitæäº¤å‰åè¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ï¼Œåœ¨æäº¤ä¹‹å‰æ£€æŸ¥ä»£ç æ˜¯å¦è§„èŒƒã€è¿›è¡Œç»Ÿä¸€çš„æ ¼å¼åŒ–å¤„ç†ã€æ£€æŸ¥gitæäº¤çš„ä¿¡æ¯æ ¼å¼ç­‰ç­‰ï¼›
2. *eslint*ï¼šä¸€ä¸ªç”¨NodeJSå†™çš„Javascriptä»£ç æ£€æŸ¥å·¥å…·ï¼Œå¯è‡ªå®šä¹‰è§„åˆ™ï¼›
3. *lint-staged*ï¼šä¸€ä¸ªèƒ½å¤Ÿåªå¯¹gitå˜æ›´æ–‡ä»¶è¿›è¡Œä»£ç æ£€æŸ¥çš„å·¥å…·ï¼›
4. *commitizen*ï¼šä¸€ä¸ªæä¾›äº†äº¤äº’å¼å‘½ä»¤ï¼Œå¯ç”¨äºè§„èŒƒgit commitä¿¡æ¯çš„å·¥å…·ã€‚

ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬è¿™æ¬¡è¦ç”¨åˆ°çš„å››ä¸ªå·¥å…·ã€‚


### 2ã€å®ç°æ€è·¯

æˆ‘ä»¬å¯ä»¥é€šè¿‡huskyæä¾›çš„é’©å­(hooks)ï¼š

- åœ¨gitæäº¤å‰ï¼Œä½¿ç”¨eslintæˆ–è€…lint-stagedå¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶è¿›è¡Œç»Ÿä¸€çš„æ ¼å¼åŒ–å¤„ç†ï¼›

- åœ¨gitæäº¤æ—¶ï¼Œæ£€æŸ¥git commitçš„æ ¼å¼æ˜¯å¦ç¬¦åˆè§„å®šï¼›åŒæ—¶ï¼Œä½¿ç”¨commitizenå®ç°å‘½ä»¤è¡Œäº¤äº’ï¼Œæ¥è¾…åŠ©æˆ‘ä»¬ç”Ÿæˆåˆè§„çš„git commitã€‚

### 3ã€å…·ä½“å®ç°
#### 3.1 husky
å®‰è£…ï¼š
```
yarn add husky -D
```

![package.json](https://img-blog.csdnimg.cn/img_convert/0141382b4aef307550749f44f6f0512b.png)

åœ¨`package.json`çš„`script`ä¸­æ·»åŠ ï¼š
```json
"scripts": {
  "prepare": "husky install"
}
```

`prepare`æ˜¯`npm`çš„ç”Ÿå‘½å‘¨æœŸè„šæœ¬ã€‚

å½“æ‰§è¡Œ`npm install`çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œè„šæœ¬å†…å®¹`husky install`ï¼Œä»è€Œåœ¨å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ç”Ÿæˆ`.husky`æ–‡ä»¶å¤¹ã€‚


![.husky](https://img-blog.csdnimg.cn/img_convert/3770e076ca60e61e9bd3e9259749fb82.png)

è¿™é‡Œçš„`husky.sh`é…ç½®ä¸»è¦æ˜¯ä¸ºäº†è·å–hookçš„æ‰§è¡Œç»“æœï¼Œå½“æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™æ—¶ï¼Œå°±é€€å‡ºè¿›ç¨‹ã€‚


æ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨**git hooks**å•¦ã€‚

#### 3.2 hookï¼špre-commit
å‘½ä»¤è¡Œæ‰§è¡Œ`yarn husky add .husky/pre-commit`ç”Ÿæˆ`pre-commit`è„šæœ¬ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨ï¼‰ï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

undefined
```

ç¨ä½œä¿®æ”¹ï¼Œæ¥éªŒè¯ä¸‹åœ¨git commitçš„æ—¶å€™æ˜¯å¦æ‰§è¡Œäº†è¿™ä¸ªè„šæœ¬ï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "commitä¹‹å‰æ‰§è¡Œ"
```
å‘½ä»¤è¡Œgitæäº¤ä»£ç ï¼š
```
git add .
git commit -mâ€add husky configâ€
```

![pre-commitæ‰§è¡Œç»“æœ](https://img-blog.csdnimg.cn/img_convert/82067250e964bd48c8d4da122e672d2b.png)

å¯ä»¥çœ‹åˆ°pre-commitè„šæœ¬æ‰§è¡ŒæˆåŠŸï¼Œæ‰“å°å‡ºäº†è¯­å¥ã€‚

#### 3.3 åœ¨pre-commité‡Œæ·»åŠ eslintæ£€æŸ¥
å®‰è£…ï¼š
```
yarn add eslint â€”dev
```
å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œ

```
yarn run eslint â€”init
```
æˆ–
```
./node_modules/.bin/eslint â€”init
```

![è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯airbnbçš„ä»£ç è§„èŒƒ](https://img-blog.csdnimg.cn/img_convert/24b1203b8fc204e70003e92d00bf600d.png)

æ‰§è¡Œå®Œæˆåä¼šè‡ªåŠ¨åœ¨æ ¹ç›®å½•ç”Ÿæˆ`eslint`é…ç½®æ–‡ä»¶`.eslinttrc.js`ã€‚

![](https://img-blog.csdnimg.cn/img_convert/6b7463722f379a00eb1381cb0bda6a7a.png)


ä¿®æ”¹`pre-commit`ï¼Œæ·»åŠ eslintæ ¼å¼æ£€æŸ¥ï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"


echo "eslintæ ¼å¼æ ¡éªŒ" && ./node_modules/.bin/eslint src/*

```


![eslintæ£€æŸ¥ç»“æœ](https://img-blog.csdnimg.cn/img_convert/e33f24c008a5158458b2e7aa8e6dd0bd.png)

å¯ä»¥çœ‹åˆ°ï¼Œeslintæ£€æµ‹å‡ºä»£ç é‡Œæœ‰2ä¸ª`error`å’Œ1ä¸ª`warning`ã€‚

erroræ˜¯å¿…é¡»ä¿®æ”¹çš„ï¼Œå¯ä»¥ä½¿ç”¨`eslint --fix`è‡ªåŠ¨ä¿®å¤ï¼Œå¹¶æ‰§è¡Œ`git add .`æŠŠfixåçš„å˜æ›´ä¹Ÿæ·»åŠ åˆ°gitç¼“å­˜åŒºï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "eslintæ ¼å¼æ ¡éªŒ"

./node_modules/.bin/eslint src/* --fix # å¯¹srcä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä½œeslintæ£€æŸ¥ï¼Œå¹¶ç”¨--fixä¿®å¤error

git add . # å°†eslintçš„fixå†…å®¹ä¹Ÿæ·»åŠ åˆ°gitæäº¤ä¸­
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![eslintä¿®å¤äº†errorå¹¶æäº¤æˆåŠŸ](https://img-blog.csdnimg.cn/img_convert/e035e24964ab50cf3105b3996a13d9d9.png)

æˆåŠŸï¼


æç¤ºï¼šå¦‚æœä½¿ç”¨çš„æ˜¯Github Desktopè¿™ç±»çš„å›¾å½¢å·¥å…·ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¸‹é¢è¿™ä¸ªé”™è¯¯â€”â€”

![](https://img-blog.csdnimg.cn/img_convert/1741602b9bd809f60128741bc4682c0a.png)

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨é¡¹ç›®é‡Œå®‰è£…äº†eslintï¼Œå½“åœ¨è½¯ä»¶ä¸Šè¿è¡Œçš„æ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°è·¯å¾„é”™è¯¯ï¼Œåªéœ€è¦å…¨å±€å®‰è£…ä¸€ä¸‹eslintå°±å¯ä»¥äº†ï¼š

```
yarn add eslint -g
```

ä¸Šé¢çš„eslintæ£€æŸ¥è„šæœ¬ä¼šå¯¹`src`ä¸­çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ–°é¡¹ç›®è¿˜å¥½ï¼Œå¦‚æœæ˜¯ä¸€äº›è€é¡¹ç›®ï¼Œé‚£ä¹ˆæ¶‰åŠåˆ°çš„å˜æ›´æ–‡ä»¶å°±ä¼šå¾ˆå¤šã€‚

å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½å…¨é‡æ£€æµ‹ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡`git diff`æ¥è·å–åˆ°å˜æ›´çš„æ–‡ä»¶ï¼š

ä¿®æ”¹pre-commitï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "eslintæ ¼å¼æ ¡éªŒ"

arr=`git diff --name-only  HEAD` # æŸ¥çœ‹å˜æ›´æ–‡ä»¶
for filepath in ${arr[@]}
do
    if [[ "$filepath" =~ ^[src/] ]]; then : # åªæ£€æµ‹srcä¸‹è¢«ä¿®æ”¹çš„æ–‡ä»¶çš„æ ¼å¼
        if [ -f "$filepath" ];then # åªå¯¹å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œfixï¼Œè·³è¿‡deleteçš„æ–‡ä»¶
            echo $filepath
            ./node_modules/.bin/eslint $filepath --fix
            git add $filepath
        fi
    fi
done
```
è¿™æ®µä»£ç å®ç°äº†ï¼šåªå¯¹srcä¸­*æœ‰å˜æ›´ä¸”éåˆ é™¤çš„æ–‡ä»¶*è¿›è¡Œeslintæ£€æŸ¥å’Œfixã€‚

è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„**lint-staged**ï¼Œä¹Ÿèƒ½å®ç°åŒæ ·çš„åŠŸèƒ½ï¼Œä½¿ç”¨èµ·æ¥**æ›´ç®€å•**ã€‚

æ‰§è¡Œ`npx mrm@2 lint-staged`ï¼Œå¯ä»¥çœ‹åˆ°`package.json`ä¸­å¤šäº†å…³äº`lint-staged`çš„é…ç½®ï¼š

![package.json](https://img-blog.csdnimg.cn/img_convert/b25e5806a802374f6d8f004ab2cd7f5f.png)


ä¿®æ”¹ä¸€ä¸‹ï¼š
```json
"lint-staged": {
    "src/*": "eslint --fix"
}
```

pre-commitæ”¹ä¸ºï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "eslintæ ¼å¼æ ¡éªŒ"

npx lint-staged
```
æµ‹è¯•ä¸€ä¸‹ï¼š

![lint-stagedä»£ç æ£€æŸ¥](https://img-blog.csdnimg.cn/img_convert/c748560141eeae41794ab7d5f1e1fb1f.png)

æˆåŠŸï¼

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®ç°äº†åŸºæœ¬çš„ä»£ç è§„èŒƒé…ç½®ã€‚

eslintçš„è¯¦ç»†é…ç½®å‚æ•°è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»å®˜ç½‘ä¸Šè‡ªè¡Œæ¢ç´¢ã€‚

#### 3.4 ç”¨commitizenè§„èŒƒgit commit
å®‰è£…ï¼š
```
npm install --save-dev commitizen
```
åœ¨package.jsonä¸­é…ç½®ï¼š
```json
  "scripts": {
    "commit": "cz"
  },
  "config": {
    "commitizen": {
      "path": "cz-conventional-changelog"
    }
  }
```
æµ‹è¯•ä¸€ä¸‹ï¼š

![](https://img-blog.csdnimg.cn/img_convert/6f65de55c1ba37a7b9212afbbfc5ebc4.png)

æ³¨æ„ï¼Œè¿™é‡Œå°±ä¸èƒ½ç”¨`git commit`äº†ï¼Œè€Œè¦ç”¨**yarn run commit**æˆ–**npm run commit**ï¼Œæ‰§è¡Œåå‘½ä»¤è¡Œé‡Œä¼šå‡ºç°ä¸€äº›äº¤äº’é€‰é¡¹ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆgit commitã€‚

![commitizenç”Ÿæˆçš„commit](https://img-blog.csdnimg.cn/img_convert/4c3b1390e5de47ebbc4f76fcf3dbaba4.png)


çœ‹ä¸ä¹ æƒ¯è‹±æ–‡çš„ä¹Ÿå¯ä»¥å®‰è£…ä¸­æ–‡åŒ…ï¼š
```
yarn add cz-conventional-changelog-zh
```

![ä¸­æ–‡ç‰ˆæ•ˆæœ](https://img-blog.csdnimg.cn/img_convert/e1e7759cdebfd53378c359237498ce9e.png)

**commitizen**åªèƒ½å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆè§„èŒƒçš„git commitï¼Œå¦‚æœæœ‰äº›é˜Ÿå‹å¿˜äº†ä½¿ç”¨yarn run commitï¼Œè€Œç›´æ¥ç”¨git commit -mâ€xxxâ€å†™äº†ä¸è§„èŒƒçš„æäº¤ä¿¡æ¯ï¼Œæ€ä¹ˆåŠï¼Ÿ

è¿˜è®°å¾—ä¸Šé¢è¯´çš„**husky**å—ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡huskyçš„**commit-msg**é’©å­æ¥æ ¡éªŒgit commitçš„æäº¤ä¿¡æ¯ã€‚

#### 3.5 hookï¼šcommit-msg

```
yarn husky add .husky/commit-msg
```
ä¿®æ”¹commit-msgï¼š
```sh
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"


commit_regex='^Merge.+|(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|types)(\(.+\))?: .{1,50}'


if ! grep -iqE "$commit_regex" "$1"; then

echo
echo "commitä¿¡æ¯æ ¼å¼é”™è¯¯ï¼ï¼"

echo "æ ¼å¼åº”ä¸ºï¼š[Type]: [Summary]"

echo "Typeå¯é€‰å€¼ä¸ºMerge|feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|types"

echo "æ³¨æ„ä¸­é—´çš„ç©ºæ ¼"

echo "ç¤ºä¾‹ï¼šgit commit -m \"test: add something test\""

echo
exit 1

fi
```
æµ‹è¯•ä¸€ä¸‹ï¼š

![æ ¡éªŒgit commitçš„ä¿¡æ¯æ ¼å¼](https://img-blog.csdnimg.cn/img_convert/ab028f537e47460293c87ba5c11f159f.png)


**å¤§åŠŸå‘Šæˆï¼**



### 4ã€æ€»ç»“

è§„èŒƒçš„ä»£ç ä¸ä»…èƒ½å‡å°‘åˆå¹¶å†²çªï¼Œè¿˜æœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œé™ä½ä¹‹åçš„ç»´æŠ¤æˆæœ¬ã€‚

å¯¹å›¢é˜Ÿè€Œè¨€ï¼Œæœ‰å¯èƒ½æ˜¯é“æ‰“çš„ä»£ç æµæ°´çš„ç¨‹åºå‘˜ï¼Œå‰äººç•™ä¸‹çš„å‘å¾—åäººå»å¡«ï¼Œè§„èŒƒä»£ç æ˜¯éå¸¸å¿…è¦çš„ã€‚

å¯¹ä¸ªäººè€Œè¨€ï¼Œè§„èŒƒçš„ä»£ç ä¸ä»…èƒ½å‡å°‘bugçš„å‡ºç°ï¼Œè¿˜æœ‰åŠ©äºæ›´å¥½åœ°ç†è§£ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œæˆé•¿æœ‰æ—¶å€™å°±æ˜¯è¿™äº›ç»†èŠ‚å¤„çš„ç§¯ç´¯ã€‚

æŠ€æœ¯ä¸Šåªèƒ½èµ·åˆ°ä¸€éƒ¨åˆ†çš„è§„èŒƒä½œç”¨ï¼Œæ›´é‡è¦çš„è¿˜æ˜¯æ„è¯†ä¸Šçš„ä¸»è§‚èƒ½åŠ¨æ€§ï¼Œåªæœ‰æ„è¯†åˆ°ä»£ç è§„èŒƒçš„é‡è¦æ€§ï¼Œæ‰èƒ½çœŸæ­£å®ç°é¡¹ç›®çš„ä»£ç è§„èŒƒåŒ–ã€‚


##### é™„å½•
- [husky](https://github.com/typicode/husky)
- [eslint](https://eslint.org/)
- [lint-staged](https://github.com/okonet/lint-staged)
- [commitizen](https://github.com/commitizen/cz-cli)
- [airbnbä»£ç è§„èŒƒ](https://github.com/BingKui/javascript-zh)
